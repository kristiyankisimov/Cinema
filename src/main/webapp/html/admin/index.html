<!DOCTYPE html>
<html>
<head>
<title>Cinema</title>
<meta charset="UTF-8">
<link rel="stylesheet" type="text/css "
	href="./../../styles/userstyle.css">
<link rel="stylesheet" type="text/css"
	href="./../../styles/program-style.css">
	<link rel="stylesheet" type="text/css"
	href="./../../styles/admin-style.css">
<script type="text/javascript" src="./../../js/jquery-2.1.3.min.js"></script>

<script type="text/javascript">
	$(function(){
		  $("#header").load("./../../header.html"); 
		  $("#footer").load("./../../footer.html"); 
		  
		  $.ajax({
				url : './../../rest/screenings',
				type : "GET",
				contentType : "application/json;charset=UTF-8",
				statusCode : {
					200 : function(data) {
						var screenings = data.screening;
						for(var i = 0; i < screenings.length; i++) {
							var screening = screenings[i];
							var option = '<option value="'+ screening.id +'">'+'Movie: '+ screening.movie.title +' Date: '+
							screening.date +' Hall: '+ screening.hall.number
							'</option>';
							
							$('#allScreenings').append(option);
							
						}
					}
				}
			});
		  
		});
	$(document).ready(function() {
		$('#getTicketsByScreening').click(function() {
			var id = $('#allScreenings').find(":selected").val();
			var a = './../../rest/tickets/' + id;
			 $.ajax({
					url : a,
					type : "GET",
					contentType : "application/json;charset=UTF-8",
					statusCode : {
						200 : function(data) {
							var tickets = data.ticket;
							$("#screening_table tr:gt(0)").remove();
							for(var i = 0; i < tickets.length; i++) {
								var ticket = tickets[i];								
								renderRow(ticket);
							}
						}
					}
				});
			
		});
	});
	
	function renderRow(ticket) {
		var row = $("<tr />")
		$("#screening_table").append(row);
		row.append($("<td>" + ticket.seat.rowNumber + "</td>"));
		row.append($("<td>" + ticket.seat.colNumber + "</td>"));
		row.append($("<td>" + ticket.user.name + "</td>"));
		row.append($("<td>" + ticket.checked + "</td>"));
		if (ticket.checked == false) {
			row.append($("<td>" + "<button onclick=check(" + ticket.id + ") value=" + ticket.id + ">Check</button>" + "</td>"));
		}
	}
	function check(id){
		 $.ajax({
				url : './../../rest/tickets/' + id,
				type : "POST",
				contentType : "application/json;charset=UTF-8",
				statusCode : {
					200 : function(data) {
						var id = $('#allScreenings').find(":selected").val();
						var a = './../../rest/tickets/' + id;
						$.ajax({
							url : a,
							type : "GET",
							contentType : "application/json;charset=UTF-8",
							statusCode : {
								200 : function(data) {
									var tickets = data.ticket;
									$("#screening_table tr:gt(0)").remove();
									for(var i = 0; i < tickets.length; i++) {
										var ticket = tickets[i];								
										renderRow(ticket);
									}
								}
							}
						});
					}
				}
				
			});
	}
	
	
</script>

</head>
<body>
	<br>
	<div align="center">
		<h1>Cinema ---- ADMIN</h1>
	</div>
	
	<br><br>
	
	<select id="allScreenings">
	</select>
	
	<button id = "getTicketsByScreening"> Ticket by screening</button>
	<div>
			<table id="screening_table" class="CSSTableGenerator" >
				<tr>
					<th>Row</th>
					<th>Column</th>
					<th>Name</th>
					<th>Checked</th>
				</tr>
			</table>
		</div>
	
	<br><br>
	
	<form id="logout_form" name="logout_form" method="get" action="./../../rest/user/logout">
		<button type="submit" class="btn btn-default"> Log out </button>
	</form>
	<br>
</body>
</html>