<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title></title>
<link rel="stylesheet" type="text/css" href="./../../styles/seat-style.css">
<script
	src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"
	type="text/javascript"></script>

<script src="jquery.qrcode-0.7.0/jquery.qrcode-0.7.0.min.js"
	type="text/javascript"></script>

<script type="text/javascript">
	function generate() {
		$('#reservationScreen').hide();
		var rols = 15;
		var cols = 24;
		var cnt = 1;
		var jj = 1;

		for (i = 0; i <= rols; i++) {
			for (j = 0; j <= cols; j++) {
				if (j % 6 === 0 && j !== 0) {
					$('#seats').append("<div class='emptySpace'></div>");

				} else if (j === 0) {
					$('#seats').append(
							"<div class='emptySpace'>" + i + "</div>");

				} else if (i === 0 && j % 6 !== 0) {
					$('#seats').append(
							"<div class='emptySpace'>" + cnt + "</div>");
					cnt++;

				} else {
					$('#seats')
							.append(
									"<div class='seat' id='"
											+ i
											+ "-"
											+ jj
											+ "' onclick='show_reservation_screen(this)'></div>");
					jj++;

				}
			}
			$('#seats').append("<br>");
			jj = 1;
		}
	}

	function updateSeats() {
		$.get('DB.txt', function(myContentFile) {
			var lines = myContentFile.split("\r\n");
			myObject = {};
			for ( var i in lines) {
				myObject[i] = lines[i]
				//console.log(lines[i]);
				document.getElementById(lines[i]).setAttribute("style",
						"background-color: red;");
				document.getElementById(lines[i]).setAttribute("onclick", "");
			}
		}, 'text');
	}

	var id;
	function show_reservation_screen(v) {
		id = v.id;
		$("<p>You have chosen seat " + id + "</p>").insertBefore("#beforeMe");
		$('#seats').fadeOut(1000);
		setTimeout("$('#reservationScreen').fadeIn('slow')", 1000);
	}

	function send_request() {
		var fname = document.getElementById("fname").value;
		var sname = document.getElementById("sname").value;
		var gsm = document.getElementById("gsm").value;
		//alert(fname + " " + sname + " " + gsm + " " + id);
		$('#qr').qrcode({
			width : 80,
			height : 80,
			color : '#3a3',
			text : fname + " " + sname + ", " + gsm + ", seat(rol, col): " + id
		});
		//var requestData = {
		//    firstName: fname,
		//    secondName: sname,
		//    GSM: gsm,
		//    seatNo: id
		//};
		//alert(JSON.stringify(requestData));

		document.location.href = "Server?param=" + id;

	}
</script>


</head>
<body>

	<center>
		<div id="stage">
			<h2>Screen</h2>
			<div id="screen"></div>
			<div id="seats"></div>
			<div id="reservationScreen">
				<p id="beforeMe">Enter your credentials and press 'Submit' to
					confirm and reserve the seat.</p>
				<table>
					<tr>
						<td>First Name:</td>
						<td><input type="text" id='fname'></td>
					</tr>
					<tr>
						<td>Last Name:</td>
						<td><input type="text" id='sname'></td>
					</tr>
					<tr>
						<td>Phone Number:</td>
						<td><input type="text" id='gsm'></td>
					</tr>
					<tr>
						<td><input type="button" onclick='send_request()'
							value='Submit'></td>
					</tr>
				</table>
				<div id="qrDiv">
					<div id="qr"></div>
				</div>
			</div>
		</div>
	</center>
	<script type="text/javascript">
		generate();
		updateSeats();
	</script>

</body>
</html>
